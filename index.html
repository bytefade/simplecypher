<!doctype html>
<html>
    <head>
        <title>Simple cypher</title>
    </head>
    <body>
        <h4>Cifrar texto</h4>
        <label>Texto original</label>
        <textarea id="text"></textarea>
        <button onclick="init_cifrar()">cifrar</button>
        <label>Texto cifrado</label>
        <textarea id="cifrada"></textarea>

        <h4>Decifrar texto</h4>
        <label>Texto cifrado</label>
        <textarea id="text_cifrado"></textarea>
        <button onclick="init_decifrar()">decifrar</button>
        <label>Texto original</label>
        <textarea id="decifrada"></textarea>
    </body>
    <script>
        const ALPHANUMERIC_LENGHT = 35;
        function init_cifrar() {
            let text = document.getElementById("text").value.toUpperCase();
            let msgs = text.split(" ");

            let cifrada = "";

            let contMsgs = 0;

            for (msg of msgs) {
                let len = msg.length;

                let numberOfStep = step();

                cifrada += `$${numberOfStep}$`;

                for (i = 0; i < len; i++) {
                    let index = caracteres(i, msg[i]);
                    let retorno_cifrada = cifrar(index, numberOfStep, i);

                    cifrada += caracteres(retorno_cifrada);
                }
                if (msgs.length > 1 && contMsgs < msgs.length - 1) {
                    cifrada += "@";
                }
                contMsgs++;
            }
            let textAreaCifrada = document.getElementById("cifrada");
            textAreaCifrada.innerHTML = cifrada;
        }
        function cifrar(index, step, position) {
            let offset = position % 2 === 0 ? step : -step;
            let result =
                (index + offset + ALPHANUMERIC_LENGHT) % ALPHANUMERIC_LENGHT;
            return result;
        }
        function init_decifrar() {
            let text = document
                .getElementById("text_cifrado")
                .value.toUpperCase();
            let msgs = text.split("@");

            let decifrada = "";

            let contMsgs = 0;

            for (msg of msgs) {
                let step = msg.split("$")[1];
                let newmsg = msg.split("$")[2];
                let len = newmsg.length;

                for (i = 0; i < len; i++) {
                    let cipherIndex = caracteres(i, newmsg[i]);
                    let retorno_cifrada = decifrar(cipherIndex, step, i);
                    console.log("retorno_cifrada", retorno_cifrada);

                    decifrada += caracteres(retorno_cifrada);
                }
                if (msgs.length > 1 && contMsgs < msgs.length - 1) {
                    decifrada += " ";
                }
            }
            let textAreaCifrada = document.getElementById("decifrada");
            textAreaCifrada.innerHTML = decifrada;
        }

        function decifrar(cipherIndex, step, position) {
            let offset = position % 2 === 0 ? step : -step;
            let result =
                (cipherIndex - offset + ALPHANUMERIC_LENGHT) %
                ALPHANUMERIC_LENGHT;
            return result;
        }

        function caracteres(index, simbolo = null) {
            let caracteres = [
                "A",
                "B",
                "C",
                "D",
                "E",
                "F",
                "G",
                "H",
                "I",
                "J",
                "K",
                "L",
                "M",
                "N",
                "O",
                "P",
                "Q",
                "R",
                "S",
                "T",
                "U",
                "V",
                "W",
                "X",
                "Y",
                "Z",
                "0",
                "1",
                "2",
                "3",
                "4",
                "5",
                "6",
                "7",
                "8",
                "9",
            ];

            if (simbolo) {
                return caracteres.indexOf(simbolo);
            }

            return caracteres[index];
        }
        function step() {
            return Math.floor(Math.random() * ALPHANUMERIC_LENGHT);
        }
    </script>
</html>
