<!doctype html>
<html>
    <head>
        <title>Simple cypher</title>
        <link rel="stylesheet" href="app.css" />
    </head>
    <body>
        <main>
            <div class="config">
                <h4>Configurações</h4>
                <fieldset>
                    <legend>Saída do texto:</legend>
                    <div>
                        <input
                            type="radio"
                            id="alta"
                            value="alta"
                            name="type_text"
                            checked
                        />
                        <label for="alta">Maiúscula</label>
                    </div>
                    <div>
                        <input
                            type="radio"
                            id="baixa"
                            value="baixa"
                            name="type_text"
                        />
                        <label for="baixa">Minúscula</label>
                    </div>
                </fieldset>
                <fieldset>
                    <legend>Tipo de separador:</legend>
                    <div>
                        <select id="separador">
                            <option value="">Selecione</option>
                            <option value="@" selected>@</option>
                            <option value="$">$</option>
                            <option value="#">#</option>
                            <option value="&">&</option>
                            <option value="_">_</option>
                        </select>
                    </div>
                </fieldset>
            </div>
            <div class="cypher">
                <h4>Cifrar texto</h4>
                <label>Texto original</label>
                <textarea class="input" id="text"></textarea>
                <button onclick="init_cifrar()">cifrar</button>
                <label>Texto cifrado</label>
                <textarea class="output" id="cifrada"></textarea>
            </div>

            <div class="cypher">
                <h4>Decifrar texto</h4>
                <label>Texto cifrado</label>
                <textarea class="input" id="text_cifrado"></textarea>
                <button onclick="init_decifrar()">decifrar</button>
                <label>Texto original</label>
                <textarea class="output" id="decifrada"></textarea>
            </div>
        </main>
    </body>
    <script>
        const ALPHANUMERIC_LENGHT = 56;
        const ALTERNATIVE_SEPARATOR = "__";
        function init_cifrar() {
            let text = document.getElementById("text").value.toUpperCase();
            let msgs = text.split(" ");
            let separador = tipoSeparador();

            console.log(separador);
            let cifrada = "";

            let contMsgs = 0;

            for (msg of msgs) {
                msg = msg.trim();
                let len = msg.length;

                let numberOfStep = step();

                if (separador === "$") {
                    cifrada += `${ALTERNATIVE_SEPARATOR}${numberOfStep}${ALTERNATIVE_SEPARATOR}`;
                } else {
                    cifrada += `$${numberOfStep}$`;
                }

                for (i = 0; i < len; i++) {
                    let index = caracteres(i, msg[i]);
                    let retorno_cifrada = cifrar(index, numberOfStep, i);

                    cifrada += caracteres(retorno_cifrada);
                }
                if (msgs.length > 1 && contMsgs < msgs.length - 1) {
                    cifrada += separador;
                }
                contMsgs++;
            }
            let textAreaCifrada = document.getElementById("cifrada");
            textAreaCifrada.innerHTML = cifrada;
        }
        function cifrar(index, step, position) {
            let offset = position % 2 === 0 ? step : -step;
            let result =
                (index + offset + ALPHANUMERIC_LENGHT) % ALPHANUMERIC_LENGHT;
            return result;
        }
        function init_decifrar() {
            let text = document
                .getElementById("text_cifrado")
                .value.toUpperCase();
            let separador = tipoSeparador();
            let msgs = text.split(separador);

            let decifrada = "";

            let contMsgs = 0;

            for (msg of msgs) {
                let step, newmsg;
                console.log("separador", separador);
                if (separador === "$") {
                    step = msg.split(ALTERNATIVE_SEPARATOR)[1];
                    newmsg = msg.split(ALTERNATIVE_SEPARATOR)[2];
                } else {
                    step = msg.split("$")[1];
                    newmsg = msg.split("$")[2];
                }
                console.log(step, newmsg);
                let len = newmsg.length;

                for (i = 0; i < len; i++) {
                    let cipherIndex = caracteres(i, newmsg[i]);
                    let retorno_cifrada = decifrar(cipherIndex, step, i);
                    console.log("retorno_cifrada", retorno_cifrada);

                    decifrada += caracteres(retorno_cifrada);
                }
                if (msgs.length > 1 && contMsgs < msgs.length - 1) {
                    decifrada += " ";
                }
            }

            tipoDeTexto(decifrada);
        }

        function decifrar(cipherIndex, step, position) {
            let offset = position % 2 === 0 ? step : -step;
            let result =
                (cipherIndex - offset + ALPHANUMERIC_LENGHT) %
                ALPHANUMERIC_LENGHT;
            return result;
        }
        function tipoDeTexto(decifrada) {
            let textAreaCifrada = document.getElementById("decifrada");
            let tipoSaidaTexto = document.querySelector(
                'input[name="type_text"]:checked',
            ).value;
            console.log(tipoSaidaTexto);
            textAreaCifrada.innerHTML =
                tipoSaidaTexto == "alta"
                    ? decifrada.toUpperCase()
                    : decifrada.toLowerCase();
        }

        function tipoSeparador() {
            return document.getElementById("separador").value;
        }
        function caracteres(index, simbolo = null) {
            let caracteres = [
                "A",
                "B",
                "C",
                "D",
                "E",
                "F",
                "G",
                "H",
                "I",
                "J",
                "K",
                "L",
                "M",
                "N",
                "O",
                "P",
                "Q",
                "R",
                "S",
                "T",
                "U",
                "V",
                "W",
                "X",
                "Y",
                "Z",
                "Á",
                "À",
                "Â",
                "Ã",
                "É",
                "Ê",
                "Í",
                "Ó",
                "Ô",
                "Õ",
                "Ú",
                "Ç",
                "!",
                // "@",
                // "#",
                // "%",
                // "^",
                // "&",
                // "*",
                // "(",
                // ")",
                // "+",
                // "=",
                // "{",
                // "}",
                // "[",
                // "]",
                ";",
                ":",
                "'",
                ",",
                ".",
                // "<",
                // ">",
                "?",
                // "/",
                // "'\'",
                "|",
                // "~",
                "-",
                // "$",
                // "€",
                // "£",
                "0",
                "1",
                "2",
                "3",
                "4",
                "5",
                "6",
                "7",
                "8",
                "9",
            ];

            if (simbolo) {
                // console.log("simbolo", simbolo);
                // console.log("simbolo retorno", caracteres.indexOf(simbolo));
                return caracteres.indexOf(simbolo);
            }

            return caracteres[index];
        }
        function step() {
            let random = Math.floor(Math.random() * ALPHANUMERIC_LENGHT);

            if (random === 0) {
                return step();
            }

            return random;
        }
    </script>
</html>
