<!doctype html>
<html>
    <head>
        <title>Simple cypher</title>
    </head>
    <body>
        <h4>Cifrar texto</h4>
        <label>Texto original</label>
        <textarea id="text"></textarea>
        <button onclick="main()">cifrar</button>
        <label>Texto cifrado</label>
        <textarea id="cifrada"></textarea>

        <!--<h4>Decifrar texto</h4>
        <label>Texto cifrado</label>
        <textarea id="text_cifrado"></textarea>
        <button onclick="decifrar()">decifrar</button>
        <label>Texto original</label>
        <textarea id="decifrada"></textarea>-->
    </body>
    <script>
        function main() {
            let text = document.getElementById("text").value.toUpperCase();
            let msgs = text.split(" ");

            let palavra_base = "";
            let cifrada = "";

            for (msg of msgs) {
                let len = msg.length;
                let k = gerarKValido(len);

                for (i = 0; i < len; i++) {
                    let i_letra = caracteres(i, msg[i]);

                    let retorno_cifrada = cifrar(i_letra, len, k);
                    let caracter = caracteres(retorno_cifrada);
                    let existe = cifrada.indexOf(caracter);

                    if (existe !== -1) {
                        cifrada += caracteres(retorno_cifrada + 1);
                    } else {
                        cifrada += caracteres(retorno_cifrada);
                    }
                }
            }
            let textAreaCifrada = document.getElementById("cifrada");
            textAreaCifrada.innerHTML = cifrada;
        }

        function cifrar(i, wl, k) {
            return ((i + k * wl) % wl) + 1;
        }
        function decifrar(pos_cif, wl, k) {
            return ((pos_cif - 1 - k * wl) % wl) + 1;
        }

        // Função para gerar um k válido (coprimo com WL)
        function gerarKValido(wl, tentativas = 100) {
            for (let k = 1; k < tentativas; k++) {
                if (mdc(k, wl) === 1) {
                    return k;
                }
            }
            return 1; //fallback seguro (1 é sempre coprimo)
        }

        // Função para calcular MDC (Máximo Divisor Comum)
        function mdc(a, b) {
            while (b !== 0) {
                let temp = b;
                b = a % b;
                a = temp;
            }
            return a;
        }

        function caracteres(index, simbolo = null) {
            let caracteres = [
                "A",
                "B",
                "C",
                "D",
                "E",
                "F",
                "G",
                "H",
                "I",
                "J",
                "K",
                "L",
                "M",
                "N",
                "O",
                "P",
                "Q",
                "R",
                "S",
                "T",
                "U",
                "V",
                "W",
                "X",
                "Y",
                "Z",
                "0",
                "1",
                "2",
                "3",
                "4",
                "5",
                "6",
                "7",
                "8",
                "9",
            ];

            if (simbolo) {
                return caracteres.indexOf(simbolo);
            }

            return caracteres[index];
        }
    </script>
</html>
